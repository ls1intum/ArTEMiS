<jhi-alert></jhi-alert>
<div *ngIf="exercise !== undefined">

    <div class="header-container  bg-primary text-white">
        <h4 class="card-header">
            <strong>{{exercise.id}} - {{exercise.title}}</strong>
        </h4>
    </div>

    <div class="row mt-3 justify-content-around">
        <div class="col-4 text-center">
            <p class="h3">Your status:</p>
            <jhi-tutor-participation-graph
                [tutorParticipation]="tutorParticipation"></jhi-tutor-participation-graph>
        </div>
        <div class="col-4 text-center">
            <p class="h3">Your assessments:</p>
            <p class="font-weight-bold">{{numberOfTutorAssessments}} / 5 </p>
        </div>
    </div>

    <div class="col-12 text-center" style="margin-bottom: 15px">
        <div *ngIf="tutorParticipationStatus === NOT_PARTICIPATED" class="alert alert-warning" role="alert">
            You need to read the grading instructions before starting assessing
        </div>

        <button class="btn btn-primary" (click)="open(gradingInstructions)">
            Read grading instructions
        </button>
    </div>

    <ng-template #gradingInstructions let-c="close" let-d="dismiss">
        <div class="modal-header">
            <h4 class="modal-title">Grading instructions</h4>
            <button type="button" class="close" aria-label="Close" (click)="d()"><span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            {{exercise.gradingInstructions}}
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="c()">Close</button>
            <button type="button" class="btn btn-primary" *ngIf="tutorParticipationStatus === NOT_PARTICIPATED"
                    (click)="readInstruction(c)">I read and understood the instructions
            </button>
        </div>
    </ng-template>

    <div *ngIf="tutorParticipationStatus === REVIEWED_INSTRUCTIONS" class="alert alert-warning row" role="alert">
        You need to successfully assess at least {{numberOfNeededSubmissions}} example submissions before continuing. There are {{exampleSubmissionsToComplete.length}} example submissions to review.
    </div>

    <div class="row" *ngIf="tutorParticipationStatus !== NOT_PARTICIPATED">
        <div class="col-6" *ngIf="exampleSubmissionsForTutorial.length > 0">
            <p class="h3">Review submissions</p>
            <div class="alert alert-info" role="alert">You can use these examples as a tutorial</div>

            <ul>
                <li *ngFor="let exampleSubmission of exampleSubmissionsForTutorial">
                    <button routerLink="/text/{{exercise.id}}/exampleSubmission/{{exampleSubmission.id}}" [queryParams]="{readOnly: true}"
                            class="btn btn-link">Example submission {{exampleSubmission.id}}</button>
                </li>
            </ul>
        </div>

        <div class="col-6" *ngIf="exampleSubmissionsToComplete.length > 0">
            <p class="h3">Tutorial submissions ({{exampleSubmissionsCompletedByTutor.length}}/{{numberOfNeededSubmissions}})</p>
            <div class="alert alert-info" role="alert">You can use these examples as an exercise</div>

            <ul>
                <li *ngFor="let exampleSubmission of exampleSubmissionsToComplete">
                    <button routerLink="/text/{{exercise.id}}/exampleSubmission/{{exampleSubmission.id}}" [queryParams]="{toComplete: true}"
                            class="btn btn-link">Example submission {{exampleSubmission.id}}</button>
                    <fa-icon icon="check-circle" *ngIf="hasBeenCompletedByTutor(exampleSubmission.id)"></fa-icon>
                </li>
            </ul>
        </div>

    </div>
    <div class="table-responsive"
         *ngIf="tutorParticipationStatus === TRAINED || tutorParticipationStatus === COMPLETED">
        <table class="table table-striped exercise-table">
            <thead>
            <tr>
                <th>#</th>
                <th>Submission date</th>
                <th>Result</th>
                <th>Status</th>
                <th>Score</th>
                <th>Reviewer</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr [ngStyle]="submission.optimal && {'font-weight': 'bold'}"
                *ngFor="let submission of submissions; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ submission.submissionDate | date:'MMM d, y HH:mm:ss' }}</td>
                <td>
                    <jhi-result [participation]="submission.participation"></jhi-result>
                </td>
                <td>

                </td>
                <td>
                    <span
                        *ngIf="submission.result !== null && submission.result.score !== null">{{submission.result.score}}
                        %</span>
                </td>
                <td>
                    <span
                        *ngIf="submission.result !== null && submission.result.assessor !== null">{{ submission.result.assessor.firstName }} {{ submission.result.assessor.lastName }}</span>
                </td>
                <td>
                    <span *jhiHasAnyAuthority="['ROLE_ADMIN', 'ROLE_INSTRUCTOR']">
                    <button *ngIf="submission !== null && submission.result === null"
                            routerLink="/text/{{exercise.id}}/assessment/{{submission.id}}"
                            class="btn btn-outline-secondary btn-sm">
                        <i class="fa fa-folder-open fa-fw"></i>&nbsp;Assess Submission
                    </button>
                    </span>
                    <button *ngIf="submission !== null && submission.result !== null"
                            routerLink="/text/{{exercise.id}}/assessment/{{submission.id}}"
                            class="btn btn-outline-secondary btn-sm">
                        <i class="fa fa-folder-open fa-fw"></i>&nbsp;Open assessment
                    </button>
                </td>
            </tr>
            <tr *ngIf="unassessedSubmission !== null && unassessedSubmission.id > 0">
                <td></td>
                <td>{{ unassessedSubmission.submissionDate | date:'MMM d, y HH:mm:ss' }}</td>
                <td></td>
                <td>NEW</td>
                <td></td>
                <td></td>
                <td>
                    <button routerLink="/text/{{exercise.id}}/assessment/{{unassessedSubmission.id}}" class="btn btn-success">
                        <i class="fa fa-folder-open fa-fw"></i>Start new assessment
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
