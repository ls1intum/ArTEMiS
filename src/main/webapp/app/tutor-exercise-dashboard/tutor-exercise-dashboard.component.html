<div *ngIf="exercise !== null">
    <jhi-alert></jhi-alert>

    <div class="header-container  bg-primary text-white">
        <h4 class="card-header">
            <strong>{{exercise.id}} - {{exercise.title}}</strong>
        </h4>
    </div>

    <div class="row mt-3 justify-content-around">
        <div class="col-4 text-center">
            <p class="h3">Your assessments:</p>
            <p class="font-weight-bold">{{numberOfTutorAssessments}} / 5 </p>
        </div>
    </div>

    <div *ngIf="tutorParticipationStatus === NOT_PARTICIPATED">
        You need to read the grading instructions before starting assessing
    </div>

    <button class="btn btn-default" (click)="open(gradingInstructions)">
        Read grading instructions
    </button>

    <ng-template #gradingInstructions let-c="close" let-d="dismiss">
        <div class="modal-header">
            <h4 class="modal-title">Grading instructions</h4>
            <button type="button" class="close" aria-label="Close" (click)="d()"><span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            {{exercise.gradingInstructions}}
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline" (click)="c()">Close</button>
            <button type="button" *ngIf="tutorParticipationStatus === NOT_PARTICIPATED"
                    (click)="readInstruction() && c()">I read and understood the instructions
            </button>
        </div>
    </ng-template>

    <h4>Example submissions</h4>
    <div *ngIf="tutorParticipationStatus === REVIEWED_INSTRUCTIONS">
        You need to test the example submissions before continuing. There are <b>{{exampleSubmissions.length}}</b>
        example submissions to review.
    </div>

    <ul *ngIf="exampleSubmissions.length > 0">
        <li *ngFor="let exampleSubmission of exampleSubmissions">
            Review example submission {{exampleSubmission.id}}

            <!-- TODO: make a real assessment of the example submission -->
            <button type="button"
                    (click)="assessExampleSubmission(exampleSubmission)">Do example submission!
            </button>
        </li>
    </ul>

    <div class="table-responsive"
         *ngIf="tutorParticipationStatus === TRAINED || tutorParticipationStatus === COMPLETED">
        <table class="table table-striped exercise-table">
            <thead>
            <tr>
                <th>#</th>
                <th>Submission date</th>
                <th>Result</th>
                <th>Submission count</th>
                <th>Score</th>
                <th>Assessment Type</th>
                <th>Reviewer</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr [ngStyle]="submission.optimal && {'font-weight': 'bold'}"
                *ngFor="let submission of submissions; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ submission.submissionDate | date:'MMM d, y HH:mm:ss' }}</td>
                <td>
                    <jhi-result [participation]="submission.participation"></jhi-result>
                </td>
                <td>
                    <ng-container *ngIf="submission.participation.submissions !== null">
                        {{ submission.participation.submissions.length }}
                    </ng-container>
                </td>
                <td>
                    <span *ngIf="submission.result !== null && submission.result.score !== null">{{submission.result.score}}
                        %</span>
                </td>
                <td>{{ submission.result && submission.result.assessmentType }}</td>
                <td>
                    <span
                        *ngIf="submission.result !== null && submission.result.assessor !== null">{{ submission.result.assessor.firstName }} {{ submission.result.assessor.lastName }}</span>
                </td>
                <td>
                    <span *jhiHasAnyAuthority="['ROLE_ADMIN', 'ROLE_INSTRUCTOR']">
                    <button *ngIf="submission !== null && submission.result === null"
                            routerLink="/text/{{exercise.id}}/assessment/{{submission.id}}"
                            class="btn btn-outline-secondary btn-sm">
                        <i class="fa fa-folder-open fa-fw"></i>&nbsp;Assess Submission
                    </button>
                    </span>
                    <button *ngIf="submission !== null && submission.result !== null"
                            routerLink="/text/{{exercise.id}}/assessment/{{submission.id}}"
                            class="btn btn-outline-secondary btn-sm">
                        <i class="fa fa-folder-open fa-fw"></i>&nbsp;Open assessment
                    </button>
                </td>
            </tr>
            <tr *ngIf="unassessedSubmission != null && unassessedSubmission.id > 0">
                <td></td>
                <td>{{ unassessedSubmission.submissionDate | date:'MMM d, y HH:mm:ss' }}</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>
                    <button routerLink="/text/{{exercise.id}}/assessment/{{unassessedSubmission.id}}">
                        <i class="fa fa-folder-open fa-fw"></i>Start new assessment
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
