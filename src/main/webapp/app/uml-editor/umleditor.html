<div class="editor-wrapper">

    <nav class="navbar navbar-default editor-top" role="navigation">
        <div class="">
            <div class="navbar-header" >
                <button type="button" class="navbar-toggle" ng-click="vm.toggleNavbar()">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand logo" ui-sref="courses" ng-click="vm.collapseNavbar()">
                    <img class="logo-img logo-img-tum" src="content/images/logo_tum.png"/>
                    <img class="logo-img" src="content/images/logo_l1_weiss.png"/>
                    <span translate="global.title" class="hidden-sm">TUM LS1 Exercises </span><span
                    class="hidden-sm">: </span> <span>{{$ctrl.participation.exercise.course.title}}</span>
                </a>
            </div>
            <div class="navbar-collapse" uib-collapse="vm.isNavbarCollapsed">

                <div class=" navbar-nav navbar-right">

                    <!--
                    <result participation="$ctrl.participation" ng-hide="$ctrl.isBuilding"
                            on-new-result="$ctrl.updateLatestResult($event)" show-score="true"></result>
                    <button type="button" class="btn btn-primary navbar-btn"
                            ng-disabled="!$ctrl.isSaved || $ctrl.isBuilding" ng-click="$ctrl.commit($event)"
                            ng-switch="$ctrl.isBuilding" tooltip-placement="left"
                            uib-tooltip="Stage, commit, push, build and test your changes.">
                        <span ng-switch-when="true"><i class="fa fa-circle-o-notch fa-spin"></i> Building</span>
                        <span ng-switch-default><i class="fa fa-play-circle-o"></i> Commit & Run Tests</span>
                    </button>

                    -->
                </div>

            </div>
        </div>
    </nav>


    <div class="editor-main" style="display: table-row; height: 100%; overflow: hidden;">

        <div id="main-container"
             style="width: 100%; height: 100%; border: none; margin: 0; padding: 0; display: block;">

        </div>

        <script src="/app/uml-editor/frame/EditorBundled.js"></script>
        <script>

            var Repository = angular.element('*[ng-app]').injector().get("Repository");
            var RepositoryFile = angular.element('*[ng-app]').injector().get("RepositoryFile");
           // var parentController = angular.element(document.getElementById('uml-editor-root')).scope();
            var url = window.window.location.href;
            var urlIndex = url.lastIndexOf('/');
            var participationId = Number(url.substring(urlIndex + 1));


            //
            // Function to load the file
            //
            function loadFile(successCallback, errorCallback) {
                RepositoryFile.get({
                        participationId: participationId,
                        file: "submission.json"
                    }, function (fileObj) {
                        try {
                            successCallback(JSON.parse(fileObj.fileContent))
                        } catch (e) {
                            errorCallback(e)
                        }
                    },
                    function (error) {
                        errorCallback(error)
                    }
                );
            }


            //
            //
            //
            function saveAndCommitFile(umlDocumentAsJson, successCallback, errorCallback) {

                RepositoryFile.update({
                    participationId: participationId,
                    file: "submission.json"
                }, JSON.stringify(umlDocumentAsJson), function () {
                    console.log("Saved file");

                    Repository.commit({
                        participationId: participationId
                    }, {}, function () {
                        console.log('comitted');
                        successCallback()
                    }, function (err) {
                        console.log(err);
                        errorCallback(err)
                    });

                }, function (err) {
                    console.log(err);
                    errorCallback(err)
                })


            } // End save Function


            UmlClassEditor.startUmlEditor(loadFile, saveAndCommitFile, null, true);

        </script>


        <!--
        <div class="editor-center" style="" background: red;">
            </div>

        <div class="editor-sidebar-right">

            <editor-instructions participation="$ctrl.participation"
                                 latest-result="$ctrl.latestResult"></editor-instructions>

        </div>
        -->

    </div>


</div>

