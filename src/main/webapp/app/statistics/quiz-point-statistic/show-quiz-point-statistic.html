<div class="row">
    <!--<div class="col-md-4">
        <span class="hipster img-responsive img-rounded"></span>
    </div>-->
    <div class="col-md-8 col-md-offset-2 text-center">
        <h3>{{vm.quizExercise.title}}</h3>
        <div class="row">
            <div class="col-md-3 text-left">
                <p style="font-size: large"><span>Maximalpunkte: {{vm.maxScore}}</span></p>


            </div>
            <div class="col-md-9 text-center">
                <p>&nbsp</p>
                <div class="col-md-8 text-left"><p id="text" style="font-size: large">Punkteverteilung (bewertet)</p></div>
                <div class="col-md-3 text-right"><p id="participants" style="font-size: large">{{vm.participants}} Teilnehmer</p></div>
                <canvas id="myChart"></canvas>



                <div class="col-md-6 text-center">
                    <button id="ratedButton" ng-click="vm.switchRated()" type="button" class="btn btn-primary"><span class="glyphicon glyphicon-refresh"></span>&nbsp;Zeige unbewertete Antworten</button>
                </div>
            </div>

        </div>
    </div>
</div>
<script>


    // Define a plugin to provide data labels
    Chart.plugins.register({
        afterDatasetsDraw: function(chart, easing) {
            // To only draw at the end of animation, check for easing === 1
            var ctx = chart.ctx;

            chart.data.datasets.forEach(function (dataset, i) {
                var meta = chart.getDatasetMeta(i);
                if (!meta.hidden) {
                    meta.data.forEach(function(element, index) {
                        // Draw the text in black, with the specified font
                        ctx.fillStyle = 'black';

                        var fontSize = 12;
                        var fontStyle = 'normal';
                        var fontFamily = 'Calibri';
                        ctx.font = Chart.helpers.fontString(fontSize, fontStyle, fontFamily);

                        // Just naively convert to string for now

                        var dataNumber = dataset.data[index];
                        var dataPersentageNumber = (Math.round((dataset.data[index] /dataset.participants) *1000)/10);

                        // Make sure alignment settings are correct
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';

                        var padding = 5;
                        var position = element.tooltipPosition();
                        if(Math.round(dataPersentageNumber > 6)) {
                            ctx.fillText(dataNumber.toString(), position.x, position.y - (fontSize / 2) - padding);

                            ctx.fillStyle = 'white';
                            ctx.fillText(dataPersentageNumber.toString()+"%", position.x, position.y + (fontSize / 2) + padding);
                        }else{
                            ctx.fillText(dataNumber.toString() + " / " + dataPersentageNumber.toString()+"%", position.x, position.y - (fontSize / 2) - padding);
                        }
                    });
                }
            });
        }
    });
    var barChartData = {
        labels: [], // Array ermöglicht Zeilenumbruch
        datasets: [{
            //label: 'Anzahl der Antwort',
            display: false,
            data: [],
            backgroundColor: [],
            borderWidth: 0,
            participants: 0
        }]
    }


    var ctx = document.getElementById("myChart").getContext('2d');
    window.myChart = new Chart(ctx, {
        type: 'bar',
        data: barChartData,
        options: {
            layout: {
                padding: {
                    left: 50,
                    right: 50,
                    top: 0,
                    bottom: 30
                }
            },
            legend: {
                display: false
            },
            title: {
                position: "top",
                fontSize: "16",
                padding: 20
            },
            tooltips: {
                enabled: false
            },
            scales: {
                yAxes: [{
                    scaleLabel: {
                        labelString: 'Häufigkeit',
                        display: true,
                    },
                    ticks: {
                        beginAtZero: true
                    }
                }],
                xAxes: [{
                    scaleLabel: {
                        labelString: 'Punkte',
                        display: true,
                    },
                }]
            },
        }
    });

</script>
