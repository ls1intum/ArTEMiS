<div class="row">
    <!--<div class="col-md-4">
        <span class="hipster img-responsive img-rounded"></span>
    </div>-->
    <div class="col-md-8 col-md-offset-2 text-center">
        <h3>{{vm.quizExercise.title}}</h3>
        <div class="row">
            <div class="col-md-4 text-left">
                <h3>{{vm.question.title}}</h3>
                <h4>{{vm.question.text}}</h4>
                <ol type=a>
                <li ng-repeat="answer in vm.question.answerOptions"><span> {{answer.text}}</span></li>
                </ol>

            </div>
            <div class="col-md-8 text-center">
                <p>&nbsp</p>
                <div class="col-md-8 text-left"><p id="text" style="font-size: large">
                    <span ng-show="vm.rated" data-translate="showStatistic.multipleChoiceQuestionStatistic.titleRated"></span>
                    <span ng-show="!vm.rated" data-translate="showStatistic.multipleChoiceQuestionStatistic.titleUnrated"></span></p></div>
                <div class="col-md-3 text-right"><p style="font-size: large"><span>{{vm.participants}} </span><span data-translate="showStatistic.participants"></span></p></div>
                <canvas id="myChart"></canvas>


                <div class="col-md-12 text-center" >
                    <button ng-click="vm.switchSolution()" type="button" class="btn btn-primary">
                        <span ng-show="vm.showSolution" class="glyphicon glyphicon-ok-circle"></span>&nbsp;
                        <span ng-show="!vm.showSolution" class="glyphicon glyphicon-remove-circle"></span>&nbsp;
                        <span ng-show="vm.showSolution" data-translate="showStatistic.switchToUnrated"></span>
                        <span ng-show="!vm.showSolution" data-translate="showStatistic.switchToRated"></span></button></button>

                    <button ng-click="vm.switchRated()" type="button" class="btn btn-primary">
                        <span class="glyphicon glyphicon-refresh"></span>&nbsp;
                        <span ng-show="vm.rated" data-translate="showStatistic.switchToUnrated"></span>
                        <span ng-show="!vm.rated" data-translate="showStatistic.switchToRated"></span></button>
                </div>
                <p>&nbsp</p>
            </div>

        </div>
    </div>
</div>
<div class="statistic-footer">
    <div class="container">
        <div class="edit-quiz-footer-content">
            <div class="form-group">
                <div class="btn-group dropup" uib-dropdown>
                    <button
                        type="button"
                        class="btn btn-default"
                        aria-haspopup="true"
                        aria-expanded="false"
                        uib-dropdown-toggle
                    >
                        <span class="hidden-xs hidden-sm" data-translate="showStatistic.chooseStatistic"></span>
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a ui-sref="quiz-point-statistic-chart({quizId: vm.quizExercise.id})"
                               data-translate="showStatistic.quizPointStatisticTitle"></a></li>
                        <li><a ui-sref="quiz-statistic-chart({quizId: vm.quizExercise.id})"
                               data-translate="showStatistic.quizStatisticTitle"></a></li>
                        <li ng-repeat="question in vm.quizExercise.questions"><a ui-sref="multiple-choice-question-statistic-chart({quizId: vm.quizExercise.id, questionId: question.id})"
                        ><div style="text-indent:10px;">{{$index + 1}}. {{question.title}}</div></a></li>
                    </ul>
                </div>
            </div>
            <div class="form-group">
                <div class="btn-group flex-btn-group-container">
                    <button ng-click=vm.previousStatistic()
                            data-translate="showStatistic.previousStatistic"
                        class="btn btn-default"></button>
                    <button ng-click=vm.nextStatistic()
                            data-translate="showStatistic.nextStatistic"
                        class="btn btn-default"></button>
                </div>
            </div>
            <div class="form-group">
                <button ng-show="!vm.quizExercise.quizPointStatistic.released" ng-click=vm.releaseStatistics(true);
                        data-translate="showStatistic.releaseStatistic" has-any-authority="ROLE_ADMIN, ROLE_TA"
                        ng-disabled="vm.releaseButtonDisabled()"
                        class="btn btn-success"
                ></button>
                <button ng-show="vm.quizExercise.quizPointStatistic.released" ng-click=vm.releaseStatistics(false);
                        data-translate="showStatistic.rereleaseStatistic" has-any-authority="ROLE_ADMIN, ROLE_TA"
                        class="btn btn-danger"
                ></button>
            </div>
        </div>
    </div>
</div>
<script>

    var barChartData = {
        labels: [], // Array ermöglicht Zeilenumbruch
        datasets: [{
            //label: 'Anzahl der Antwort',
            display: false,
            data: [],
            backgroundColor: [],
            borderWidth: 0
        }]
    }


    var ctx = document.getElementById("myChart").getContext('2d');
    window.myChart = new Chart(ctx, {
        type: 'bar',
        data: barChartData,
        options: {
            layout: {
                padding: {
                    left: 0,
                    right: 0,
                    top: 0,
                    bottom: 30
                }
            },
            legend: {
                display: false
            },
            title: {
                display: false,
                text: "Antwortenverteilung",
                position: "top",
                fontSize: "16",
                padding: 20
            },
            tooltips: {
                enabled: false
            },
            scales: {
                yAxes: [{
                    scaleLabel: {
                        labelString: 'Häufigkeit der Antwort',
                        display: true,
                    },
                    ticks: {
                        beginAtZero: true
                    }
                }],
                xAxes: [{
                    scaleLabel: {
                        labelString: 'Antwortmöglichkeiten',
                        display: true,
                    },
                }]
            },
            hover: {animationDuration: 0},
            animation: {
                duration: 500,
                onComplete: function () {
                    var chartInstance = this.chart,
                        ctx = chartInstance.ctx;
                    var fontSize = 12;
                    var fontStyle = 'normal';
                    var fontFamily = 'Calibri';
                    ctx.font = Chart.helpers.fontString(fontSize, fontStyle, fontFamily);
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';

                    this.data.datasets.forEach(function (dataset, i) {
                        var meta = chartInstance.controller.getDatasetMeta(i);
                        meta.data.forEach(function (bar, index) {
                            var data = dataset.data[index];
                            var dataPersentage = (Math.round((dataset.data[index] /barChartData.participants) *1000)/10);

                            var position = bar.tooltipPosition();

                            if(dataPersentage > 6) {
                                if(position.y > 15){
                                    ctx.fillStyle = 'black';
                                    ctx.fillText(data, position.x, position.y - 10);


                                    if(barChartData.participants !== 0){
                                        ctx.fillStyle = 'white';
                                        ctx.fillText(dataPersentage.toString()+"%", position.x, position.y + 10);
                                    }
                                }
                                else{
                                    ctx.fillStyle = 'white';
                                    if(barChartData.participants !== 0){
                                        ctx.fillText(data + " / " + dataPersentage.toString()+"%", position.x, position.y + 10);
                                    }else{
                                        ctx.fillText(data, position.x, position.y + 10);
                                    }
                                }
                            }
                            else{
                                ctx.fillStyle = 'black';
                                if(barChartData.participants !== 0){
                                    ctx.fillText(data + " / " + dataPersentage.toString()+"%", position.x, position.y - 10);
                                }else{
                                    ctx.fillText(data, position.x, position.y - 10);
                                }
                            }
                        });
                    });
                }
            }
        }
    });

</script>
