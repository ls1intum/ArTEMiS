<jhi-alert></jhi-alert>

<div class="course-info-bar">
    <div class="row justify-content-between">
        <div class="col-8">
            <h2>
                <fa-icon [icon]="'arrow-left'" (click)="previous()" class="back-button mr-2"></fa-icon>
                <span *ngIf="submission?.exampleSubmission">Example </span>Assessment Editor for Text Exercise {{exercise?.title}}
            </h2>
        </div>

        <div class="col-4 text-right">
            <h5 class="text-white"><strong>Score:</strong> {{ totalScore | number : '1.0-2' }} / {{ exercise.maxScore }}</h5>

            <button class="btn btn-primary ml-3" (click)="save()"
                    [disabled]="!assessments || !assessmentsAreValid || (result?.assessor && result.assessor.id !== accountId && !isAuthorized)"
                    *ngIf="!result || !result.completionDate">Save Assessment
            </button>
            <button class="btn btn-success ml-3" (click)="submit()"
                    [disabled]="!assessments || !assessmentsAreValid || (result?.assessor && result.assessor.id !== accountId && !isAuthorized)"
                    *ngIf="!result || !result.completionDate">Submit Assessment
            </button>
            <button class="btn btn-danger ml-3" (click)="submit()" [disabled]="!assessments || !assessmentsAreValid"
                    *ngIf="result && result.completionDate">Override Assessment
            </button>
        </div>
    </div>
</div>

<div class="row justify-content-end mt-4">
    <div class="col text-right">
        <span *ngIf="result && participation && showResult"><jhi-result [participation]="participation"></jhi-result></span>
        <span *ngIf="result && result.assessor" style="color:red"><h6>Reviewer: {{result.assessor.firstName + (isAuthorized ? '' : ' - submission locked')}}</h6></span>
    </div>
</div>

<h2>
    <span *ngIf="busy" style="color:grey"><fa-icon icon="spinner" [spin]="true"></fa-icon>&nbsp;<span>Please wait while ArTEMiS is finding the submission!</span></span>
</h2>

<div class="row mt-4" *ngIf="!busy && exercise">
    <div class="card flex-grow-1 resizable-submission mr-4">
        <div class="card-header text-white bg-primary">Student submission</div>
        <div class="card-body">
            <jhi-text-assessment-editor [submissionText]="submission?.text" [assessments]="assessments"
                                        (assessedText)="addAssessment($event)"></jhi-text-assessment-editor>
        </div>
    </div>

    <div class="resizable-submission card" id="instructions" [ngStyle]="{'width.px':400}">
        <!-- Required for resizing; don't remove empty span -->
        <div class="resizing-bar"><span></span></div>

        <div class="card-header text-white bg-primary" (click)="toggleCollapse($event)">
            <span class="float-right "><fa-icon icon="chevron-right"></fa-icon></span>
            <h3 class="card-title">
                <fa-icon [icon]="['far', 'list-alt']"></fa-icon>
                <span> &nbsp; Instructions &nbsp; </span>
            </h3>
        </div>

        <div class="card-body">
            <div *ngIf="exercise.problemStatement">
                <h4>Problem statement</h4>
                <p>{{exercise.problemStatement}}</p>

                <hr>
            </div>

            <div *ngIf="exercise.sampleSolution">
                <h4>Sample solution</h4>
                <p>{{exercise.sampleSolution}}</p>

                <hr>
            </div>

            <div *ngIf="exercise.gradingInstructions">
                <h4>Grading instructions</h4>
                <p>{{exercise.gradingInstructions}}</p>
            </div>
        </div>
    </div>
</div>

<div class="col-12 mt-3" *ngIf="!busy">
    <div *ngIf="invalidError" class="alert alert-danger" role="alert">{{invalidError}}</div>
    <div *ngIf="!assessments || assessments.length == 0" class="alert alert-secondary" role="alert" jhiTranslate="arTeMiSApp.textAssessment.assessInstruction"></div>
    <div class="row">
        <div *ngFor="let assessment of assessments; let i = index" class="col-4">
            <jhi-text-assessment-detail [(assessment)]="assessments[i]" (assessmentChange)="checkScoreBoundaries()"
                                        [highlightColor]="getColorForIndex(i)"
                                        (deleteAssessment)="deleteAssessment($event)"></jhi-text-assessment-detail>
        </div>
    </div>
</div>

