<jhi-alert></jhi-alert>

<div class="course-info-bar">
    <div>
        <button type="submit" (click)="previous()" class="btn btn-info mr-3">
            <fa-icon icon="arrow-left"></fa-icon>&nbsp;<span jhiTranslate="entity.action.back">Back</span>
        </button>
    </div>

    <h2 class="mt-3">
        <span *ngIf="submission?.exampleSubmission">Example </span>Assessment Editor for Text Exercise {{exercise?.title}}
    </h2>

    <div class="row mt-3">
        <div class="col">
            <span *ngIf="result && participation && showResult"><jhi-result [participation]="participation"></jhi-result></span>
        </div>

        <div class="col text-right">
            <span *ngIf="result && result.assessor" style="color:red"><h6>Reviewer: {{result.assessor.firstName + (isAuthorized ? '' : ' - submission locked')}}</h6></span>
        </div>
    </div>
</div>

<h2>
    <span *ngIf="busy" style="color:grey"><fa-icon icon="spinner" [spin]="true"></fa-icon>&nbsp;<span>Please wait while ArTEMiS is finding the submission!</span></span>
</h2>

<div class="row mt-5" *ngIf="!busy && exercise">
    <div class="card resizable-submission" [ngStyle]="{'width.px':1000}">
        <div class="card-header text-white bg-primary">Student submission</div>
        <div class="card-body">
            <jhi-text-assessment-editor [submissionText]="submission?.text" [assessments]="assessments"
                                        (assessedText)="addAssessment($event)"></jhi-text-assessment-editor>
        </div>

        <!-- Required for resizing; don't remove empty span -->
        <div class="resizing-bar"><span></span></div>
    </div>

    <div class="flex-grow-1 ml-5">
        <div class="card" *ngIf="exercise.problemStatement">
            <div class="card-header text-white bg-primary">Problem statement</div>
            <div class="card-body">{{exercise.problemStatement}}</div>
        </div>

        <div class="card mt-3" *ngIf="exercise.sampleSolution">
            <div class="card-header text-white bg-primary">Sample solution</div>
            <div class="card-body">{{exercise.sampleSolution}}</div>
        </div>

        <div class="card mt-3" *ngIf="exercise.gradingInstructions">
            <div class="card-header text-white bg-primary">Grading instructions</div>
            <div class="card-body">{{exercise.gradingInstructions}}</div>
        </div>
    </div>
</div>

<div class="col-12 mt-3" *ngIf="!busy">
    <div *ngIf="invalidError" class="alert alert-danger" role="alert">{{invalidError}}</div>
    <div *ngIf="!assessments || assessments.length == 0" class="alert alert-secondary" role="alert" jhiTranslate="arTeMiSApp.textAssessment.assessInstruction"></div>
    <div class="row">
        <div *ngFor="let assessment of assessments; let i = index" class="col-4">
            <jhi-text-assessment-detail [(assessment)]="assessments[i]" (assessmentChange)="checkScoreBoundaries()"
                                        [highlightColor]="getColorForIndex(i)"
                                        (deleteAssessment)="deleteAssessment($event)"></jhi-text-assessment-detail>
        </div>
    </div>
</div>

<div class="row" *ngIf="exercise">
    <div class="col">
        <h5><strong>Score:</strong> {{ totalScore | number : '1.0-2' }} / {{ exercise.maxScore }}</h5>
    </div>

    <div class="col text-right">
        <button class="btn btn-primary ml-3" (click)="save()"
                [disabled]="!assessments || !assessmentsAreValid || (result?.assessor && result.assessor.id !== accountId && !isAuthorized)"
                *ngIf="!result || !result.completionDate">Save Assessment
        </button>
        <button class="btn btn-success ml-3" (click)="submit()"
                [disabled]="!assessments || !assessmentsAreValid || (result?.assessor && result.assessor.id !== accountId && !isAuthorized)"
                *ngIf="!result || !result.completionDate">Submit Assessment
        </button>
        <button class="btn btn-danger ml-3" (click)="submit()" [disabled]="!assessments || !assessmentsAreValid"
                *ngIf="result && result.completionDate">Override Assessment
        </button>
    </div>
</div>
