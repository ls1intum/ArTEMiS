<div class="edit-dnd-question" [hidden]="showPreview">
    <div class="row">
        <div class="col-md-10 text-left">
            <div class="input-group">
                <input class="form-control" [(ngModel)]="question.title" placeholder="Question Title"
                       style="height: 33px"/>
                <span class="input-group-btn">
                <button class="btn btn-outline-secondary" type="button" (click)="resetQuestionTitle()">
                <i class="fa fa-rotate-left"></i>
            </button>
            </span>
            </div>
        </div>
        <div class="col-md-2 text-right">
            <div class="form-group">
                <div class="re-evaluate-button" (click)="moveUp()">
                    <i class="fa fa-chevron-up fa-2x"></i>
                </div>
                <div class="re-evaluate-button" (click)="moveDown()">
                    <i class="fa fa-chevron-down fa-2x"></i>
                </div>
                <div class="re-evaluate-button"(click)="resetQuestion()">
                    <i class="fa fa-rotate-left fa-2x"></i>
                </div>
                <div class="re-evaluate-button" (click)="delete()">
                    <i class="fa fa-trash fa-2x"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="question-options">
        <div class="form-group">
            <span jhiTranslate="arTeMiSApp.question.scoringType"
                  class="colon-suffix no-flex-shrink"></span>
            <select class="form-control" ng-options="option.key as option.label for option in scoringTypeOptions"
                    [(ngModel)]="question.scoringType" title="scoring type"></select>
            <span jhiTranslate="arTeMiSApp.question.score" class="colon-suffix"></span>
            <span>{{question.score}}</span>
        </div>
        <div class="form-group">
            <div class="checkbox">
                <label>
                    <input type="checkbox" [(ngModel)]="question.randomizeOrder"/>
                    <span jhiTranslate="arTeMiSApp.question.randomizeOrder"></span>
                </label>
            </div>
        </div>
        <button
            class="btn btn-outline-secondary"
            [hidden]="question.invalid"
            (click)="question.invalid = true"
            jhiTranslate="arTeMiSApp.quizExercise.re-evaluate.setQuestionInvalid"
        ></button>
        <button
            class="btn btn-outline-secondary"
            [hidden]="!question.invalid"
            [disabled]="question.invalid"
            jhiTranslate="arTeMiSApp.quizExercise.re-evaluate.questionIsInvalid"
        ></button>
    </div>
    <div class="markupEditorArea">
        <div class="question-content" style="padding-bottom: 12px">
            <div class="input-group" style="height: 60px">
                <div id="{{'question-content-editor-' + random}}" class="form-control"></div>
                <span class="input-group-btn" style="vertical-align: top">
                    <button class="btn btn-outline-secondary btn-lg" type="button" (click)="resetQuestionText()">
                    <i class="fa fa-rotate-left"></i>
                    </button>
                </span>
            </div>
        </div>
    </div>
    <hr/>
    <div class="question-options">
        <div class="form-group">
            <span jhiTranslate="arTeMiSApp.dragAndDropQuestion.changeBackgroundPicture"
                  class="colon-suffix no-flex-shrink"></span>
            <input #backgroundFile type="file" accept="image/*" (change)="setBackgroundFile($event)"/>
            <button [disabled]="isUploadingBackgroundFile || !backgroundFile" class="btn btn-outline-secondary"
                    (click)="uploadBackground()">
                <span *ngIf="isUploadingBackgroundFile"
                      jhiTranslate="arTeMiSApp.dragAndDropQuestion.uploading"></span>
                <span *ngIf="!isUploadingBackgroundFile"
                      jhiTranslate="arTeMiSApp.dragAndDropQuestion.upload"></span>
            </button>

        </div>
        <button class="btn btn-outline-secondary btn-lg" type="button" (click)="resetBackground()">
            <i class="fa fa-rotate-left"></i>
        </button>
    </div>
    <div class="instructions" *ngIf="!question.backgroundFilePath">
        <span jhiTranslate="arTeMiSApp.dragAndDropQuestion.uploadBackgroundInstructions"></span>
    </div>
    <div class="background-area">
        <img http-src="{{question.backgroundFilePath}}"
             alt="{{'arTeMiSApp.dragAndDropQuestion.noBackgroundPicture' | translate}}">
        <div id="{{'click-layer-' + random}}" class="click-layer" style="cursor: default !important;"
             [ngClass]="{disabled: !question.backgroundFilePath}">
            <div
                class="drop-location"
                ng-repeat="dropLocation in question.dropLocations"
                ng-style="{top: dropLocation.posY/2 + '%', left: dropLocation.posX/2 + '%', width: dropLocation.width/2 + '%', height: dropLocation.height/2 + '%'}"
                ng-mousedown="dropLocationMouseDown(dropLocation)"
                ui-on-drop="onDragDrop(dropLocation, $data)"
                drag-enter-class="drop-allowed"
                drag-hover-class="drop-hover"
            >
                <div class="invalid">
                    <span style="color:red;" *ngIf="dropLocation.invalid" jhiTranslate="arTeMiSApp.question.invalid"></span>
                </div>
                <div class="dimensions">
                    {{dropLocation.width}}x{{dropLocation.height}}
                </div>
                <div class="re-evaluate-button" title="Set invalid" *ngIf="!dropLocation.invalid"
                     (click)="dropLocation.invalid = true">
                    <i class="fa fa-ban fa-lg"></i>
                </div>
                <div class="re-evaluate-button" title="Reset" (click)="resetDropLocation(dropLocation)">
                    <i class="fa fa-rotate-left fa-lg"></i>
                </div>
                <div class="re-evaluate-button" title="Delete" (click)="deleteDropLocation(dropLocation)">
                    <i class="fa fa-trash fa-lg"></i>
                </div>
                <div class="resize top left" (mousedown)="resizeMouseDown(dropLocation, 'top', 'left')"></div>
                <div class="resize top center" (mousedown)="resizeMouseDown(dropLocation, 'top', 'center')"></div>
                <div class="resize top right" (mousedown)="resizeMouseDown(dropLocation, 'top', 'right')"></div>
                <div class="resize middle left" (mousedown)="resizeMouseDown(dropLocation, 'middle', 'left')"></div>
                <div class="resize middle right" (mousedown)="resizeMouseDown(dropLocation, 'middle', 'right')"></div>
                <div class="resize bottom left" (mousedown)="resizeMouseDown(dropLocation, 'bottom', 'left')"></div>
                <div class="resize bottom center" (mousedown)="resizeMouseDown(dropLocation, 'bottom', 'center')"></div>
                <div class="resize bottom right" (mousedown)="resizeMouseDown(dropLocation, 'bottom', 'right')"></div>
                <div [ngClass]="'mapping-number mapping-color-' + (getMappingIndex(getMappingsForDropLocation(dropLocation)[0]) % 8)" *ngIf="getMappingsForDropLocation(dropLocation).length">
                    {{getMappingIndex(getMappingsForDropLocation(dropLocation)[0])}}
                    <div class="unlink-mapping" (click)="deleteMappingsForDropLocation(dropLocation)">
                        <i class="fa fa-chain-broken fa-lg"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr/>
    <div *ngIf="!question.imageDragItems || !question.imageDragItems.length" class="instructions">
        <span jhiTranslate="arTeMiSApp.dragAndDropQuestion.addDragItemsInstructions"></span>
    </div>
    <div *ngIf="question.imageDragItems && question.imageDragItems.length" class="instructions">
        <span jhiTranslate="arTeMiSApp.dragAndDropQuestion.addMappingsInstructions"></span>
    </div>
    <div class="drag-items" *ngIf="question.imageDragItems && question.imageDragItems.length">
        <div class="drag-item" *ngFor="let dragItem of question.imageDragItems" ui-draggable="true" drag="dragItem"
             drag-handle-class="drag-handle">
            <div *ngIf="dragItem.pictureFilePath">
                <img ng-src="{{dragItem.pictureFilePath}}">
            </div>
            <div *ngIf="!dragItem.pictureFilePath">
                <textarea [(ngModel)]="dragItem.text" (change)="onUpdated()"></textarea>
            </div>
            <div class="delete-button">
                <div class="re-evaluate-button" title="Change to Text Drag Item"
                     *ngIf="dragItem.pictureFilePath"
                     (click)="changeToTextDragItem(dragItem)">
                    <i class="fa fa-font fa-lg"></i>
                </div>
                <div class="re-evaluate-button" title="Change to Picture Drag Item and use uploaded picture"
                     [hidden]="dragItemFile == null"
                     (click)="changeToPictureDragItem(dragItem)">
                    <i class="fa fa-picture-o fa-lg"></i>
                </div>
                <div class="re-evaluate-button" title="Set invalid" *ngIf="!dragItem.invalid"
                     (click)="dragItem.invalid = true">
                    <i class="fa fa-ban fa-lg"></i>
                </div>
                <div class="re-evaluate-button" title="Reset" (click)="resetDragItem(dragItem)">
                    <i class="fa fa-rotate-left fa-lg"></i>
                </div>
                <div class="re-evaluate-button" title="Delete" (click)="deleteDragItem(dragItem)">
                    <i class="fa fa-trash fa-lg"></i>
                </div>
            </div>
            <div class="drag-handle drag-handle-wrapper" title="Move">
                <i class="fa fa-bars fa-lg drag-handle"></i>
            </div>
            <div class="dimensions">
                <span style="color:red" *ngIf="dragItem.invalid" jhiTranslate="arTeMiSApp.question.invalid"></span>
            </div>
            <div class="mapping-numbers-wrapper">
                <!--TODO: orderBy getMappingIndex-->
                <div *ngFor="let mapping of getMappingsForDragItem(dragItem)" [ngClass]="'mapping-number mapping-color-' + (getMappingIndex(mapping) % 8)">
                    {{getMappingIndex(mapping)}}
                    <div class="unlink-mapping" (click)="deleteMapping(mapping)">
                        <i class="fa fa-chain-broken fa-lg"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="question-options">
        <div class="form-group">
            <i class="fa fa-upload"></i>
            <span *ngIf="isUploadingDragItemFile" jhiTranslate="arTeMiSApp.dragAndDropQuestion.uploading"></span>
            <span *ngIf="isUploadingDragItemFile"
                  jhiTranslate="arTeMiSApp.dragAndDropQuestion.changeDragItemPicture"></span>
            <input #dragItemFile type="file" accept="image/*" (change)="setDragItemFile($event)"/>
        </div>
    </div>
    <hr/>
</div>
