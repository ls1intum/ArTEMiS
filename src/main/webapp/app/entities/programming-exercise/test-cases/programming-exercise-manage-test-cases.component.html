<jhi-alert></jhi-alert>
<div>
    <div class="d-flex align-content-center mb-2">
        <h3 jhiTranslate="artemisApp.programmingExercise.manageTestCases.title">
            Manage Test Cases.
        </h3>
    </div>
    <div class="d-flex">
        <label class="d-flex align-items-center mb-0">
            <input type="checkbox" [checked]="showInactive" (change)="showInactive = !showInactive" />
            <span class="ml-2" jhiTranslate="artemisApp.programmingExercise.manageTestCases.showInactive">Show inactive</span>
        </label>
        <div class="d-flex align-items-center ml-auto">
            <div class="d-flex flex-column justify-content-between">
                <div *ngIf="changedTestCaseIds.length; else noUnsavedChanges" class="d-flex align-items-center badge badge-warning">
                    <fa-icon class="ml-2 text-white" icon="exclamation-triangle"></fa-icon>
                    <span class="ml-1" jhiTranslate="artemisApp.programmingExercise.manageTestCases.unsavedChanges"></span>
                </div>
                <ng-template #noUnsavedChanges>
                    <div class="d-flex align-items-center badge badge-success">
                        <fa-icon class="ml-2 text-white" icon="check-circle"></fa-icon>
                        <span class="ml-1" jhiTranslate="artemisApp.programmingExercise.manageTestCases.noUnsavedChanges"></span>
                    </div>
                </ng-template>
                <div class="d-flex align-items-center badge badge-warning" *ngIf="hasUpdatedTestCases; else noUpdatedTestCases">
                    <fa-icon
                        class="ml-2 text-white"
                        icon="exclamation-triangle"
                        [ngbTooltip]="'artemisApp.programmingExercise.manageTestCases.updatedTestCasesTooltip' | translate"
                    ></fa-icon>
                    <span class="ml-1" jhiTranslate="artemisApp.programmingExercise.manageTestCases.updatedTestCasesShort"></span>
                </div>
                <ng-template #noUpdatedTestCases>
                    <div class="d-flex align-items-center badge badge-success">
                        <fa-icon class="ml-2 text-white" icon="check-circle"></fa-icon>
                        <span class="ml-1" jhiTranslate="artemisApp.programmingExercise.manageTestCases.noUpdatedTestCases"></span>
                    </div>
                </ng-template>
            </div>
            <button
                id="save-weights-button"
                class="btn btn-primary ml-3"
                jhiTranslate="artemisApp.programmingExercise.manageTestCases.saveTestCases"
                (click)="saveWeights()"
                [disabled]="isSaving || !changedTestCaseIds.length"
            ></button>
            <button
                class="btn btn-secondary ml-3"
                (click)="resetWeights()"
                [disabled]="isSaving"
                jhiTranslate="artemisApp.programmingExercise.manageTestCases.resetWeights"
            ></button>
            <jhi-programming-exercise-trigger-all-button
                id="trigger-submission-run-button"
                [exerciseId]="exerciseId"
                [disabled]="isSaving || !hasUpdatedTestCases"
                (onBuildTriggered)="onBuildTriggered()"
            ></jhi-programming-exercise-trigger-all-button>
        </div>
    </div>
    <ngx-datatable
        id="testCaseTable"
        class="bootstrap"
        [headerHeight]="50"
        [limit]="20"
        [columnMode]="'force'"
        [footerHeight]="50"
        [rowHeight]="'auto'"
        [rows]="filteredTestCases"
        [sorts]="[{ prop: 'testName', dir: 'asc' }]"
        [rowClass]="getRowClass"
    >
        <ngx-datatable-column name="Id" prop="id">
            <ng-template ngx-datatable-cell-template let-value="value">
                {{ value }}
            </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Test Name" prop="testName">
            <ng-template ngx-datatable-cell-template let-value="value">
                {{ value }}
            </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Weight" prop="weight">
            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                <jhi-table-editable-field
                    [value]="value"
                    [canEdit]="!editing"
                    [isEditing]="editing && editing[0] === filteredTestCases[filteredTestCases.indexOf(row)] && editing[1] === EditableField.WEIGHT"
                    (onEditStart)="enterEditing(filteredTestCases.indexOf(row), EditableField.WEIGHT)"
                    (onValueUpdate)="updateEditedField($event)"
                    (onCancel)="leaveEditingWithoutSaving()"
                ></jhi-table-editable-field>
            </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="After Due Date" prop="afterDueDate">
            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                <jhi-table-editable-checkbox [value]="value" (onValueUpdate)="toggleAfterDueDate(filteredTestCases.indexOf(row))"></jhi-table-editable-checkbox>
            </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Is Active" prop="active">
            <ng-template ngx-datatable-cell-template let-value="value">
                {{ value }}
            </ng-template>
        </ngx-datatable-column>
    </ngx-datatable>
</div>
