<div class="p-4">
    <jhi-alert></jhi-alert>

    <div class="row" [ngClass]="{'align-items-center': submission?.submitted}">
        <div class="col-12 col-lg-8">
            <h2>
                <span *ngIf="!modelingExercise" jhiTranslate="arTeMiSApp.modelingEditor.title">Modeling Editor</span>
                <span *ngIf="modelingExercise">{{modelingExercise.title}}</span>
            </h2>
        </div>
        <div class="col-12 col-lg-4 text-right">
            <div *ngIf="participation"><jhi-result [participation]="participation"></jhi-result></div><br>
            <button class="btn btn-primary" (click)="saveDiagram()" [hidden]="submission?.submitted" [disabled]="isSaving">
                <ng-container *ngIf="!isSaving">
                    <fa-icon icon="save"></fa-icon>
                    <span jhiTranslate="entity.action.save">Save</span>
                </ng-container>
                <ng-container *ngIf="isSaving">
                    <fa-icon icon="sync"></fa-icon>
                    <span jhiTranslate="entity.action.saving">Saving...</span>
                </ng-container>
            </button>
            <button class="btn btn-success" (click)="submit()"
                    [disabled]="!submission || !umlModel || this.umlModel.elements.length === 0"
                    [hidden]="submission?.submitted || !isActive"
                    jhiTranslate="entity.action.submit">Submit</button>
            <button class="btn btn-warning" (click)="submit()"
                    [disabled]="!submission || !umlModel || this.umlModel.elements.length === 0"
                    [hidden]="submission?.submitted || isActive"
                    jhiTranslate="entity.action.submitDeadlineMissed">Submit (deadline missed)</button>
            <button class="btn btn-info" (click)="retry()"
                    *ngIf="isActive && submission?.submitted && result?.rated && !retryStarted">
                <fa-icon icon="sync"></fa-icon>&nbsp;<span jhiTranslate="entity.action.retry">Retry</span>
            </button>
        </div>
    </div><br>

    <div class="row" *ngIf="modelingExercise">
        <div class="col">
            <p class="mb-3">
                <span jhiTranslate="arTeMiSApp.modelingEditor.problemStatement"><strong>Problem Statement:</strong></span>
                <span [innerHTML]="problemStatement" ></span>
            </p>
        </div>
        <div class="col text-right" *ngIf="!submission?.submitted">
            <p jhiTranslate="arTeMiSApp.modelingEditor.maxScore" [translateValues]="{maxScore: modelingExercise.maxScore}">
                <strong>Max. Score: {{ modelingExercise.maxScore }}</strong>
            </p>
        </div>
    </div>

    <ng-template #help let-c="close" let-d="dismiss">
        <div class="modal-header">
            <h4 class="modal-title" jhiTranslate="arTeMiSApp.modelingEditor.helpModal.title">How to use the modeling editor</h4>
            <button type="button" class="close" aria-label="Close" (click)="d()"><span aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body">
            <table class="table">
                <tr>
                    <th jhiTranslate="arTeMiSApp.modelingEditor.helpModal.addClass.title">Add Class</th>
                    <td jhiTranslate="arTeMiSApp.modelingEditor.helpModal.addClass.text">To add a class, simply drag and drop one of the elements on the right side into the editor area on the left side.</td>
                    <td><img width="470" src="../../content/images/help-add-class.jpg"></td>
                </tr>
                <tr>
                    <th jhiTranslate="arTeMiSApp.modelingEditor.helpModal.editClass.title">Edit Class</th>
                    <td jhiTranslate="arTeMiSApp.modelingEditor.helpModal.editClass.text">To edit a class, double click it and a popup will open up, in which you can edit its components, e.g. name, attributes, methods, etc.</td>
                    <td><img width="470" src="../../content/images/help-edit-class.jpg"></td>
                </tr>
                <tr>
                    <th jhiTranslate="arTeMiSApp.modelingEditor.helpModal.moveClass.title">Move Class</th>
                    <td jhiTranslate="arTeMiSApp.modelingEditor.helpModal.moveClass.text">To move a class, select it with a single click and either use your keyboard arrows or drag and drop it.</td>
                    <td><img src="../../content/images/help-move-class.jpg"></td>
                </tr>
                <tr>
                    <th jhiTranslate="arTeMiSApp.modelingEditor.helpModal.deleteClass.title">Delete Class</th>
                    <td jhiTranslate="arTeMiSApp.modelingEditor.helpModal.deleteClass.text">To delete a class, select it with a single click and either press <code>Delete</code> or <code>Backspace</code> on your keyboard.</td>
                    <td></td>
                </tr>
                <tr>
                    <th jhiTranslate="arTeMiSApp.modelingEditor.helpModal.addAssociation.title">Add Association</th>
                    <td jhiTranslate="arTeMiSApp.modelingEditor.helpModal.addAssociation.text">To add an association, select the source class with a single click and you will see four blue circles. Those are the possible connection points for associations. Click and hold on one of those and drag it to another blue circle to create an association.</td>
                    <td><img width="470" src="../../content/images/help-add-association.jpg"></td>
                </tr>
                <tr>
                    <th jhiTranslate="arTeMiSApp.modelingEditor.helpModal.editAssociation.title">Edit Association</th>
                    <td jhiTranslate="arTeMiSApp.modelingEditor.helpModal.editAssociation.text">To edit an association, double click it and a popup will open up, in which you can edit its properties, e.g. type.</td>
                    <td><img width="470" src="../../content/images/help-edit-association.jpg"></td>
                </tr>
                <tr>
                    <th jhiTranslate="arTeMiSApp.modelingEditor.helpModal.deleteAssociation.title">Delete Association</th>
                    <td jhiTranslate="arTeMiSApp.modelingEditor.helpModal.deleteAssociation.text">To delete an association, select it with a single click and either press <code>Delete</code> or <code>Backspace</code> on your keyboard.</td>
                    <td></td>
                </tr>
                <tr>
                    <th jhiTranslate="arTeMiSApp.modelingEditor.helpModal.undo.title">Undo & Redo</th>
                    <td jhiTranslate="arTeMiSApp.modelingEditor.helpModal.undo.text">With <code>Ctrl+Z</code> and <code>Ctrl+Y</code> you can undo and redo your changes.</td>
                    <td></td>
                </tr>
            </table>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline" (click)="c()" jhiTranslate="entity.action.close">Close</button>
        </div>
    </ng-template>
    <div *ngIf="!submission?.submitted"><button class="btn btn-warning" (click)="open(help)">
        <fa-icon [icon]="['far', 'question-circle']"></fa-icon>&nbsp;
        <span jhiTranslate="arTeMiSApp.modelingEditor.helpModal.help">Help</span>
    </button></div><br>

    <div class="row">
        <div [ngClass]="{'col-9': submission?.submitted, 'col-12': !submission?.submitted}">
            <div #editorContainer style="width: 100%; height: 100vh;"></div>
        </div>
        <div class="col-3" *ngIf="submission?.submitted">
            <h4 jhiTranslate="arTeMiSApp.modelingEditor.assessment.title">Assessment</h4>
            <p *ngIf="!assessmentResult || assessmentResult?.feedbacks.length === 0"
               jhiTranslate="arTeMiSApp.modelingEditor.assessment.noAssessment">
                There is no assessment available yet.
            </p>
            <ng-container *ngIf="assessmentResult?.feedbacks.length > 0">
                <p jhiTranslate="arTeMiSApp.modelingEditor.assessment.instructions">
                    Select entities and/or associations in the editor to filter the assessment.
                </p>
                <table class="table">
                    <thead class="thead-light">
                        <tr>
                            <th jhiTranslate="arTeMiSApp.modelingEditor.assessment.element">Element</th>
                            <th class="text-center" jhiTranslate="arTeMiSApp.modelingEditor.assessment.score">Score</th>
                        </tr>
                    </thead>
                    <tbody *ngIf="assessmentsNames">
                    <!--TODO CZ: replace function call 'isSelected' in html-->
                        <tr *ngFor="let feedback of assessmentResult.feedbacks" [hidden]="(feedback.credits === 0 && !feedback.text) || !isSelected(feedback.referenceId, feedback.referenceType)">
                            <td>
                                <span>{{assessmentsNames[feedback.referenceId]['type']}} </span>
                                <code class="text-primary">{{assessmentsNames[feedback.referenceId]['name']}}</code><br>
                                <span *ngIf="feedback.text" [ngClass]="{'text-success': feedback.credits > 0, 'text-danger': feedback.credits < 0}"><strong>Feedback:</strong> {{feedback.text}}</span>
                            </td>
                            <td class="text-center">{{feedback.credits | number:'1.0-1'}}</td>
                        </tr>
                    </tbody>
                </table>
            </ng-container>
        </div>
    </div>
</div>
